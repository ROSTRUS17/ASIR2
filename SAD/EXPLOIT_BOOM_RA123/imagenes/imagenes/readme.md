# PRÁCTICA: SEGURIDAD EN APLICACIONES WEB – ASIR 2º

Objetivo
El objetivo de esta práctica es conocer y experimentar con dos vulnerabilidades web comunes: la inyección SQL (SQL Injection) y el Cross-Site Scripting (XSS). Para ello se desarrollarán dos pequeñas aplicaciones web: una en Python con Flask y otra en PHP. Posteriormente, se corregirán las vulnerabilidades detectadas aplicando las medidas de seguridad adecuadas.

Requisitos previos
Se trabajará sobre una máquina virtual configurada con:
– Python 3 y Flask
– Servidor web (Apache)
– PHP
– Base de datos SQLite


## PARTE A — Inyección SQL (SQL Injection) en Python y Flask

A1. Desarrollo de aplicación vulnerable
Crear una aplicación en Python llamada app.py que contenga un formulario de inicio de sesión. La consulta SQL debe construirse mediante concatenación de cadenas (sin usar parámetros). Se debe utilizar una base de datos con una tabla users y al menos dos usuarios de ejemplo. La aplicación debe mostrar un mensaje indicando si el inicio de sesión ha sido correcto o incorrecto.
La interfaz del formulario se desarrollará en una plantilla HTML llamada login.html

A2. Explotación de la vulnerabilidad
Ejecutar la aplicación Flask en local y acceder al formulario de inicio de sesión.
En el campo “usuario”, introducir cargas maliciosas (payloads) para conseguir un inicio de sesión válido sin conocer la contraseña, por ejemplo:

' OR 1=1 --
admin' --

Si la aplicación es vulnerable, realizará la autenticación aunque no se introduzca la contraseña correcta.

A3. Corrección y mitigación
Modificar el código Python para sustituir la concatenación de cadenas por consultas preparadas utilizando parámetros.
Volver a probar las mismas cargas maliciosas(payloads) y comprobar que ya no producen acceso no autorizado.

## PARTE B — XSS Reflejado en PHP

B1. Desarrollo de aplicación vulnerable
Crear un archivo llamado search.php que muestre en pantalla el valor recibido a través del parámetro GET “q” sin aplicar ningún filtrado ni codificación. Incluir un pequeño formulario para realizar una búsqueda.

Ejemplo de prueba:
http://tu_servidor/search.php?q=<script>alert('XSS');</script>

Si la página es vulnerable, el navegador ejecutará el código JavaScript mostrado en el parámetro.

B2. Corrección de la vulnerabilidad
Modificar el código PHP para aplicar codificación de salida mediante la función htmlspecialchars() en cualquier contenido que provenga del usuario.
Volver a probar con el mismo payload y comprobar que ya no se ejecuta ningún script, mostrando únicamente el texto como contenido literal.

## PARTE C — Implementación de XSS persistente en Flask

Consiste en almacenar en la base de datos un comentario introducido por el usuario que contenga código JavaScript. Después, mostrarlo en otra página sin sanitización para comprobar que el script se ejecuta automáticamente al visualizar la página.
Finalmente, aplicar las medidas necesarias para evitarlo mediante la codificación de la salida mostrada en pantalla.

Entrega:
-Código de la aplicación vulnerable en Flask, acompañado de capturas de pantalla donde se vea el inicio de sesión saltado mediante SQL Injection.
-Código corregido en Flask con capturas que demuestren que la vulnerabilidad ha quedado mitigada.
-Código de la aplicación vulnerable en PHP con capturas del ataque XSS mostrado en pantalla.
-Código corregido en PHP con capturas en las que se vea que el script ya no se ejecuta.
-Ejercicio de XSS persistente documentado con pruebas de explotación y su solución.

